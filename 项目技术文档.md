# Frontend Performance Analyzer - é¡¹ç›®æŠ€æœ¯æ–‡æ¡£

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

Frontend Performance Analyzer æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ VSCode æ’ä»¶ï¼Œå¯ä»¥åœ¨ç¼–å†™ä»£ç æ—¶å®æ—¶åˆ†æå‰ç«¯æ€§èƒ½é—®é¢˜ï¼Œé›†æˆ Claude AI æä¾›æ™ºèƒ½æ·±åº¦åˆ†æã€‚

**ç‰ˆæœ¬**: v0.1.3
**å‘å¸ƒæ—¶é—´**: 2026-01-27
**ä½œè€…**: YU HAO
**è®¸å¯è¯**: MIT

### æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **å®æ—¶æ€§èƒ½åˆ†æ**ï¼šç¼–å†™ä»£ç æ—¶å³æ—¶å‘ç°æ€§èƒ½é—®é¢˜
- ğŸ¤– **AI æ™ºèƒ½åˆ†æ**ï¼šé€šè¿‡ Claude CLI è¿›è¡Œæ·±åº¦æ™ºèƒ½åˆ†æ
- ğŸ“Š **å¤šç»´åº¦æ£€æµ‹**ï¼šæ¶µç›–å¾ªç¯ã€DOMã€æ¸²æŸ“ã€å†…å­˜ã€Web Vitals ç­‰å¤šä¸ªæ–¹é¢
- ğŸ¯ **ç²¾å‡†å®šä½**ï¼šåœ¨ç¼–è¾‘å™¨ä¸­ç›´æ¥æ ‡æ³¨é—®é¢˜ä»£ç 
- ğŸ’¡ **ä¼˜åŒ–å»ºè®®**ï¼šé’ˆå¯¹æ¯ä¸ªé—®é¢˜æä¾›å…·ä½“çš„ä¼˜åŒ–æ–¹æ¡ˆ
- ğŸ“ˆ **Web Vitals ç›‘æ§**ï¼šä¸“é—¨æ£€æµ‹å½±å“ INPã€FCPã€LCPã€CLS ç­‰æ ¸å¿ƒæŒ‡æ ‡çš„ä»£ç 

---

## äºŒã€é¡¹ç›®æ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VSCode Extension Host                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  extension.ts â”‚â”€â”€â”€â–¶â”‚ analyzer.ts  â”‚â”€â”€â”€â–¶â”‚  rules/      â”‚  â”‚
â”‚  â”‚  (å…¥å£æ–‡ä»¶)   â”‚    â”‚ (åˆ†æå¼•æ“)   â”‚    â”‚  (è§„åˆ™ç³»ç»Ÿ)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                    â”‚                    â”‚          â”‚
â”‚         â”‚                    â”‚                    â”‚          â”‚
â”‚         â–¼                    â–¼                    â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ diagnostics  â”‚    â”‚  claude-cli  â”‚    â”‚  report-view â”‚  â”‚
â”‚  â”‚ (è¯Šæ–­æ˜¾ç¤º)   â”‚    â”‚  (AI é›†æˆ)   â”‚    â”‚  (æŠ¥å‘Šè§†å›¾)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Claude CLI      â”‚
                    â”‚  (ç»ˆç«¯å‘½ä»¤)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ–‡ä»¶ç»“æ„

```
vscode-frontend-performance-analyzer/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts                    # æ’ä»¶å…¥å£ï¼Œè´Ÿè´£åˆå§‹åŒ–å’Œå‘½ä»¤æ³¨å†Œ
â”‚   â”œâ”€â”€ analyzer.ts                     # æ€§èƒ½åˆ†æå¼•æ“ï¼Œä»£ç è§£æå’Œè§„åˆ™åº”ç”¨
â”‚   â”œâ”€â”€ claude-cli-integration.ts       # Claude CLI é›†æˆï¼ŒAI åˆ†æ
â”‚   â”œâ”€â”€ report-view.ts                  # AI åˆ†ææŠ¥å‘Š WebView è§†å›¾
â”‚   â”œâ”€â”€ diagnostics.ts                  # è¯Šæ–­æä¾›è€…ï¼Œæ˜¾ç¤ºé—®é¢˜æ ‡è®°
â”‚   â”œâ”€â”€ types.ts                        # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ rules/                          # æ£€æµ‹è§„åˆ™ç›®å½•
â”‚       â”œâ”€â”€ index.ts                    # è§„åˆ™æ³¨å†Œä¸­å¿ƒ
â”‚       â”œâ”€â”€ loop-rule.ts                # å¾ªç¯æ€§èƒ½è§„åˆ™
â”‚       â”œâ”€â”€ dom-manipulation-rule.ts    # DOM æ“ä½œè§„åˆ™
â”‚       â”œâ”€â”€ rendering-rule.ts           # æ¸²æŸ“æ€§èƒ½è§„åˆ™
â”‚       â”œâ”€â”€ memory-leak-rule.ts         # å†…å­˜æ³„æ¼è§„åˆ™
â”‚       â”œâ”€â”€ blocking-operation-rule.ts  # é˜»å¡æ“ä½œè§„åˆ™
â”‚       â”œâ”€â”€ react-hooks-rule.ts         # React Hooks è§„åˆ™
â”‚       â”œâ”€â”€ async-operation-rule.ts     # å¼‚æ­¥æ“ä½œè§„åˆ™
â”‚       â”œâ”€â”€ network-request-rule.ts     # ç½‘ç»œè¯·æ±‚è§„åˆ™
â”‚       â””â”€â”€ web-vitals-rule.ts          # Web Vitals è§„åˆ™
â”œâ”€â”€ package.json                        # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ tsconfig.json                       # TypeScript é…ç½®
â”œâ”€â”€ README.md                           # ç”¨æˆ·æ–‡æ¡£
â””â”€â”€ CHANGELOG.md                        # æ›´æ–°æ—¥å¿—
```

### 2.3 æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### extension.ts - æ’ä»¶å…¥å£
- **èŒè´£**ï¼šæ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å‘½ä»¤æ³¨å†Œã€äº‹ä»¶ç›‘å¬
- **å…³é”®åŠŸèƒ½**ï¼š
  - `activate()`: æ’ä»¶æ¿€æ´»æ—¶åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶
  - `analyzeDocument()`: åˆ†ææ–‡æ¡£çš„æ ¸å¿ƒå‡½æ•°
  - `analyzeWithClaudeCode()`: æ‰‹åŠ¨è§¦å‘ AI æ·±åº¦åˆ†æ
  - æ–‡æ¡£ä¿å­˜/æ‰“å¼€äº‹ä»¶ç›‘å¬
  - é…ç½®å˜åŒ–ç›‘å¬

#### analyzer.ts - åˆ†æå¼•æ“
- **èŒè´£**ï¼šä»£ç è§£æã€AST éå†ã€è§„åˆ™åº”ç”¨
- **å…³é”®åŠŸèƒ½**ï¼š
  - `analyze()`: ä¸»åˆ†æå‡½æ•°
  - `extractScriptFromVue()`: Vue æ–‡ä»¶è„šæœ¬æå–
  - `checkFileLevel()`: æ–‡ä»¶çº§åˆ«æ£€æµ‹ï¼ˆå¤§å°ã€å¯¼å…¥ç­‰ï¼‰
  - `filterAndSortIssues()`: é—®é¢˜è¿‡æ»¤å’Œæ’åº

#### claude-cli-integration.ts - AI é›†æˆ
- **èŒè´£**ï¼šä¸ Claude CLI äº¤äº’ï¼Œè¿›è¡Œ AI æ·±åº¦åˆ†æ
- **å…³é”®åŠŸèƒ½**ï¼š
  - `isClaudeInstalled()`: æ£€æŸ¥ Claude CLI æ˜¯å¦å®‰è£…
  - `analyzeCode()`: è°ƒç”¨ Claude è¿›è¡Œåˆ†æ
  - `buildAnalysisPrompt()`: æ„å»º AI åˆ†ææç¤ºè¯
  - `parseAnalysisResult()`: è§£æ AI è¿”å›çš„ JSON ç»“æœ

#### report-view.ts - æŠ¥å‘Šè§†å›¾
- **èŒè´£**ï¼šæ˜¾ç¤º AI åˆ†ææŠ¥å‘Šçš„ WebView ç•Œé¢
- **å…³é”®åŠŸèƒ½**ï¼š
  - `show()`: æ˜¾ç¤ºæˆ–æ›´æ–°æŠ¥å‘Šé¢æ¿
  - `getHtmlContent()`: ç”ŸæˆæŠ¥å‘Š HTML
  - æ€§èƒ½è¯„åˆ†å¯è§†åŒ–
  - é—®é¢˜åˆ—è¡¨å±•ç¤º
  - ä¼˜åŒ–å»ºè®®å±•ç¤º

#### diagnostics.ts - è¯Šæ–­æ˜¾ç¤º
- **èŒè´£**ï¼šåœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºæ€§èƒ½é—®é¢˜æ ‡è®°
- **å…³é”®åŠŸèƒ½**ï¼š
  - `updateDiagnostics()`: æ›´æ–°è¯Šæ–­ä¿¡æ¯
  - `mapSeverity()`: ä¸¥é‡çº§åˆ«æ˜ å°„
  - æ³¢æµªçº¿æ ‡è®°å’Œæ‚¬åœæç¤º

---

## ä¸‰ã€ä¸»è¦è¿ç”¨çš„æŠ€æœ¯åŸç†

### 3.1 ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰è§£æ

**æ ¸å¿ƒæŠ€æœ¯**ï¼šä½¿ç”¨ Babel Parser å°† JavaScript/TypeScript ä»£ç è§£æä¸º ASTã€‚

**å·¥ä½œæµç¨‹**ï¼š
```javascript
// 1. è§£æä»£ç ä¸º AST
const ast = parse(scriptCode, {
    sourceType: 'module',
    plugins: ['typescript', 'jsx', 'decorators-legacy', ...],
    errorRecovery: true,
});

// 2. éå† AST èŠ‚ç‚¹
traverse(ast, {
    enter: (path) => {
        // å¯¹æ¯ä¸ªèŠ‚ç‚¹åº”ç”¨æ‰€æœ‰æ£€æµ‹è§„åˆ™
        for (const rule of rules) {
            const ruleIssues = rule.check(path, code);
            issues.push(...ruleIssues);
        }
    },
});
```

**ä¼˜åŠ¿**ï¼š
- ç²¾ç¡®çš„ä»£ç ç»“æ„ç†è§£
- å¯ä»¥æ£€æµ‹å¤æ‚çš„ä»£ç æ¨¡å¼
- æ”¯æŒå¤šç§è¯­æ³•ç‰¹æ€§ï¼ˆJSXã€TypeScriptã€è£…é¥°å™¨ç­‰ï¼‰

**ä½¿ç”¨çš„ Babel æ’ä»¶**ï¼š
- `@babel/parser`: ä»£ç è§£æ
- `@babel/traverse`: AST éå†
- `@babel/types`: èŠ‚ç‚¹ç±»å‹åˆ¤æ–­

### 3.2 è§„åˆ™å¼•æ“æ¨¡å¼

**è®¾è®¡æ¨¡å¼**ï¼šæ¯ä¸ªæ£€æµ‹è§„åˆ™å®ç°ç»Ÿä¸€çš„ `Rule` æ¥å£ã€‚

```typescript
export interface Rule {
    name: string;
    check(path: NodePath, code: string): PerformanceIssue[];
}
```

**è§„åˆ™ç³»ç»Ÿæ¶æ„**ï¼š
```
rules/
â”œâ”€â”€ index.ts (è§„åˆ™æ³¨å†Œä¸­å¿ƒ)
â”œâ”€â”€ loop-rule.ts
â”œâ”€â”€ dom-manipulation-rule.ts
â”œâ”€â”€ rendering-rule.ts
â”œâ”€â”€ memory-leak-rule.ts
â”œâ”€â”€ blocking-operation-rule.ts
â”œâ”€â”€ react-hooks-rule.ts
â”œâ”€â”€ async-operation-rule.ts
â”œâ”€â”€ network-request-rule.ts
â””â”€â”€ web-vitals-rule.ts
```

**è§„åˆ™ç¤ºä¾‹** (loop-rule.ts):
```typescript
export class LoopRule implements Rule {
    name = 'LoopRule';

    check(path: NodePath, code: string): PerformanceIssue[] {
        const issues: PerformanceIssue[] = [];

        // æ£€æŸ¥åµŒå¥—å¾ªç¯
        if (t.isForStatement(path.node)) {
            const nestedLevel = this.getLoopNestingLevel(path);
            if (nestedLevel >= 1) {
                issues.push({
                    type: IssueType.NestedLoop,
                    severity: IssueSeverity.Warning,
                    message: 'æ£€æµ‹åˆ°åµŒå¥—å¾ªç¯',
                    line: path.node.loc?.start.line || 0,
                    suggestion: 'è€ƒè™‘ä½¿ç”¨ Mapã€Set ä¼˜åŒ–'
                });
            }
        }

        return issues;
    }
}
```

**ä¼˜åŠ¿**ï¼š
- é«˜åº¦æ¨¡å—åŒ–ï¼Œæ˜“äºæ‰©å±•
- è§„åˆ™ä¹‹é—´äº’ä¸å½±å“
- å¯ä»¥çµæ´»å¯ç”¨/ç¦ç”¨è§„åˆ™

### 3.3 Vue æ–‡ä»¶å¤„ç†

**æ ¸å¿ƒæŠ€æœ¯**ï¼šä½¿ç”¨ `@vue/compiler-sfc` è§£æ Vue å•æ–‡ä»¶ç»„ä»¶ã€‚

```typescript
private extractScriptFromVue(code: string): { script: string; offset: number } {
    const { descriptor } = parseVue(code);
    if (descriptor.script || descriptor.scriptSetup) {
        const script = descriptor.scriptSetup || descriptor.script;
        // æå– script éƒ¨åˆ†å¹¶è®¡ç®—è¡Œåç§»
        return {
            script: script.content,
            offset: lines.length - 1,
        };
    }
    return { script: code, offset: 0 };
}
```

**å¤„ç†æµç¨‹**ï¼š
1. è§£æ Vue æ–‡ä»¶è·å– `<script>` æˆ– `<script setup>` å†…å®¹
2. è®¡ç®—è„šæœ¬åœ¨åŸæ–‡ä»¶ä¸­çš„è¡Œåç§»é‡
3. å¯¹è„šæœ¬å†…å®¹è¿›è¡Œ AST åˆ†æ
4. å°†é—®é¢˜ä½ç½®æ˜ å°„å›åŸæ–‡ä»¶è¡Œå·

### 3.4 VSCode æ‰©å±• API

**æ ¸å¿ƒ API ä½¿ç”¨**ï¼š

1. **DiagnosticCollection**ï¼šæ˜¾ç¤ºä»£ç é—®é¢˜æ ‡è®°
```typescript
const diagnosticCollection = vscode.languages.createDiagnosticCollection('performanceAnalyzer');
diagnosticCollection.set(document.uri, diagnostics);
```

2. **å‘½ä»¤æ³¨å†Œ**ï¼š
```typescript
vscode.commands.registerCommand('performanceAnalyzer.analyzeFile', async () => {
    await analyzeDocument(editor.document);
});
```

3. **äº‹ä»¶ç›‘å¬**ï¼š
```typescript
vscode.workspace.onDidSaveTextDocument(async (document) => {
    await analyzeDocument(document);
});
```

4. **WebView Panel**ï¼šæ˜¾ç¤º AI æŠ¥å‘Š
```typescript
const panel = vscode.window.createWebviewPanel(
    'performanceReport',
    'ğŸ¤– AI æ€§èƒ½åˆ†ææŠ¥å‘Š',
    vscode.ViewColumn.Beside,
    { enableScripts: true }
);
panel.webview.html = getHtmlContent(analysis);
```

### 3.5 å¼‚æ­¥æ¶æ„è®¾è®¡

**åŒå±‚åˆ†ææ¶æ„**ï¼š

```
ç”¨æˆ·ä¿å­˜æ–‡ä»¶
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸºç¡€è§„åˆ™åˆ†æ      â”‚ â† å¿«é€Ÿæ‰§è¡Œï¼ˆæ¯«ç§’çº§ï¼‰
â”‚ (åŒæ­¥æ‰§è¡Œ)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
ç«‹å³æ˜¾ç¤ºé»„è‰²æ³¢æµªçº¿ (å³æ—¶åé¦ˆ)
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ AI æ·±åº¦åˆ†æ       â”‚ â† åå°æ‰§è¡Œï¼ˆç§’çº§ï¼‰
                â”‚ (å¼‚æ­¥æ‰§è¡Œ)        â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                æ›´æ–°è¯Šæ–­ + æ˜¾ç¤ºæŠ¥å‘Š
```

**å¼‚æ­¥æ‰§è¡Œä»£ç **ï¼š
```typescript
// 1. ç«‹å³æ˜¾ç¤ºåŸºç¡€åˆ†æç»“æœ
diagnosticProvider.updateDiagnostics(document, basicIssues);

// 2. åå°å¼‚æ­¥æ‰§è¡Œ AI åˆ†æï¼ˆä¸é˜»å¡ç”¨æˆ·ï¼‰
(async () => {
    try {
        const claudeAnalysis = await claudeCLIIntegration.analyzeCode(...);
        const allIssues = [...basicIssues, ...claudeAnalysis.issues];
        diagnosticProvider.updateDiagnostics(document, allIssues);
        ReportView.show(context, claudeAnalysis, filePath);
    } catch (error) {
        console.error('AI åˆ†æå¤±è´¥:', error);
    }
})();
```

---

## å››ã€AI éƒ¨åˆ†çš„å®ç°ï¼ˆé‡ç‚¹ï¼‰

### 4.1 æ¶æ„è®¾è®¡

**è®¾è®¡ç†å¿µ**ï¼šç®€å•ã€å¯é ã€æ— éœ€é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          VSCode Extension                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ClaudeCLIIntegration                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ 1. buildAnalysisPrompt()            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    æ„å»ºä¸“é—¨çš„æ€§èƒ½åˆ†ææç¤ºè¯          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                 â–¼                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ 2. execAsync('claude << PROMPT')     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    é€šè¿‡ç»ˆç«¯è°ƒç”¨ claude å‘½ä»¤          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                 â–¼                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ 3. parseAnalysisResult()            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    è§£æ JSON æ ¼å¼çš„ AI å“åº”         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Claude CLI (ç»ˆç«¯)      â”‚
         â”‚   å·²ç™»å½•çš„ claude å‘½ä»¤   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Claude AI API          â”‚
         â”‚   (Anthropic)            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ ¸å¿ƒå®ç°ç»†èŠ‚

#### 4.2.1 æ£€æŸ¥ Claude CLI å¯ç”¨æ€§

```typescript
async isClaudeInstalled(): Promise<boolean> {
    try {
        await execAsync('which claude');
        return true;
    } catch (error) {
        return false;
    }
}
```

**åŸç†**ï¼š
- ä½¿ç”¨ `which` å‘½ä»¤æ£€æŸ¥ `claude` æ˜¯å¦åœ¨ç³»ç»Ÿ PATH ä¸­
- å¦‚æœä¸å¯ç”¨ï¼Œæ’ä»¶ä¼šä¼˜é›…é™çº§åˆ°ä»…ä½¿ç”¨åŸºç¡€è§„åˆ™

#### 4.2.2 æ„å»º AI åˆ†ææç¤ºè¯

```typescript
private buildAnalysisPrompt(code: string, languageId: string): string {
    return `è¯·åˆ†æä»¥ä¸‹ ${languageId} ä»£ç çš„æ€§èƒ½é—®é¢˜ï¼š

\`\`\`${languageId}
${code}
\`\`\`

## åˆ†æä»»åŠ¡

è¯·å¯¹ä»£ç è¿›è¡Œæ·±åº¦æ€§èƒ½åˆ†æï¼Œé‡ç‚¹å…³æ³¨ï¼š

1. **å¾ªç¯æ€§èƒ½é—®é¢˜**
   - å¤§å‹å¾ªç¯ï¼ˆè¿­ä»£æ¬¡æ•°è¿‡å¤šï¼‰
   - åµŒå¥—å¾ªç¯ï¼ˆå¤šå±‚åµŒå¥—ï¼‰
   - å¾ªç¯å†…çš„æ˜‚è´µæ“ä½œï¼ˆDOM æ“ä½œã€å¼‚æ­¥æ“ä½œç­‰ï¼‰

2. **DOM æ“ä½œé—®é¢˜**
   - é¢‘ç¹çš„ DOM æŸ¥è¯¢å’Œæ“ä½œ
   - åœ¨å¾ªç¯ä¸­æ“ä½œ DOM
   - å¯¼è‡´å›æµ/é‡ç»˜çš„æ“ä½œ

3. **æ¸²æŸ“æ€§èƒ½é—®é¢˜**
   - React/Vue ç»„ä»¶çš„é‡å¤æ¸²æŸ“
   - ç¼ºå°‘ key çš„åˆ—è¡¨æ¸²æŸ“
   - æœªä½¿ç”¨ memo/computed ç­‰ä¼˜åŒ–

4. **å†…å­˜æ³„æ¼é£é™©**
   - æœªæ¸…ç†çš„äº‹ä»¶ç›‘å¬å™¨
   - æœªå–æ¶ˆçš„å®šæ—¶å™¨
   - é—­åŒ…å¯¼è‡´çš„å†…å­˜æ³„æ¼

5. **é˜»å¡æ“ä½œ**
   - åŒæ­¥çš„è€—æ—¶æ“ä½œ
   - æœªä½¿ç”¨é˜²æŠ–/èŠ‚æµçš„é¢‘ç¹è°ƒç”¨

6. **æ‰“åŒ…ä½“ç§¯é—®é¢˜**
   - å®Œæ•´å¯¼å…¥å¤§å‹åº“
   - å†…è”å¤§å‹æ•°æ®

## è¾“å‡ºè¦æ±‚

è¯·ä»¥ JSON æ ¼å¼è¾“å‡ºåˆ†æç»“æœï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

\`\`\`json
{
  "overallScore": 85,
  "issues": [
    {
      "type": "nestedLoop",
      "severity": "Warning",
      "line": 10,
      "message": "æ£€æµ‹åˆ°åµŒå¥—å¾ªç¯ï¼Œå¯èƒ½å½±å“æ€§èƒ½",
      "suggestion": "è€ƒè™‘ä½¿ç”¨ Map æˆ– Set ä¼˜åŒ–æŸ¥æ‰¾æ“ä½œ"
    }
  ],
  "recommendations": [
    "ä¼˜å…ˆä¼˜åŒ–åµŒå¥—å¾ªç¯é—®é¢˜",
    "æ·»åŠ é˜²æŠ–å¤„ç†é¢‘ç¹è°ƒç”¨çš„å‡½æ•°"
  ],
  "summary": "æ•´ä½“åˆ†æè¯´æ˜..."
}
\`\`\``;
}
```

**æç¤ºè¯è®¾è®¡è¦ç‚¹**ï¼š
1. **æ˜ç¡®çš„åˆ†æç»´åº¦**ï¼š6 å¤§ç±»æ€§èƒ½é—®é¢˜ï¼Œæ¯ç±»éƒ½æœ‰å…·ä½“è¯´æ˜
2. **ç»“æ„åŒ–è¾“å‡º**ï¼šè¦æ±‚ JSON æ ¼å¼ï¼Œä¾¿äºç¨‹åºè§£æ
3. **å®Œæ•´çš„ä¸Šä¸‹æ–‡**ï¼šåŒ…å«å®Œæ•´ä»£ç å’Œè¯­è¨€ç±»å‹
4. **å…·ä½“çš„å­—æ®µå®šä¹‰**ï¼šå®šä¹‰æ¯ä¸ªå­—æ®µçš„å«ä¹‰å’Œå–å€¼èŒƒå›´

#### 4.2.3 è°ƒç”¨ Claude CLI

```typescript
async analyzeCode(code: string, languageId: string, filePath?: string): Promise<ClaudeAnalysisResult> {
    const prompt = this.buildAnalysisPrompt(code, languageId);

    try {
        // ä½¿ç”¨ heredoc æ–¹å¼ä¼ é€’ promptï¼Œé¿å…è½¬ä¹‰é—®é¢˜
        const { stdout, stderr } = await execAsync(
            `claude << 'PROMPT_END'\n${prompt}\nPROMPT_END`,
            {
                maxBuffer: 1024 * 1024 * 10,  // 10MB buffer
                timeout: 60000,               // 60ç§’è¶…æ—¶
            }
        );

        return this.parseAnalysisResult(stdout);
    } catch (error) {
        throw new Error(`Claude CLI åˆ†æå¤±è´¥: ${error.message}`);
    }
}
```

**æŠ€æœ¯ç»†èŠ‚**ï¼š
- **Heredoc è¯­æ³•**ï¼šä½¿ç”¨ `<< 'PROMPT_END'` é¿å…è½¬ä¹‰é—®é¢˜
- **ç¼“å†²åŒºå¤§å°**ï¼š10MBï¼Œè¶³å¤Ÿå¤„ç†å¤§å‹ä»£ç æ–‡ä»¶
- **è¶…æ—¶è®¾ç½®**ï¼š60 ç§’ï¼Œå¹³è¡¡ç­‰å¾…æ—¶é—´å’Œåˆ†æè´¨é‡
- **é”™è¯¯å¤„ç†**ï¼šæ•è·å¼‚å¸¸å¹¶æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯

#### 4.2.4 è§£æ AI å“åº”

```typescript
private parseAnalysisResult(response: string): ClaudeAnalysisResult {
    try {
        // å°è¯•ä»è¾“å‡ºä¸­æå– JSONï¼ˆå¯èƒ½åŒ…å«åœ¨ markdown ä»£ç å—ä¸­ï¼‰
        const jsonMatch = response.match(/```json\s*([\s\S]*?)\s*```/);

        let parsed: any;
        if (jsonMatch) {
            parsed = JSON.parse(jsonMatch[1]);
        } else {
            // å°è¯•ç›´æ¥è§£ææ•´ä¸ªè¾“å‡º
            parsed = JSON.parse(response);
        }

        // è§„èŒƒåŒ–ç»“æœ - æ·»åŠ  AI æ ‡è¯†
        const issues: PerformanceIssue[] = (parsed.issues || []).map((issue: any) => ({
            type: this.normalizeIssueType(issue.type),
            severity: this.normalizeSeverity(issue.severity),
            message: `ğŸ¤– Claude AI: ${issue.message}`,  // æ·»åŠ  AI æ ‡è¯†
            line: Math.max(0, (issue.line || 0) - 1),  // è½¬æ¢ä¸º 0-based
            column: issue.column,
            suggestion: issue.suggestion,
        }));

        return {
            issues,
            summary: parsed.summary || response,
            overallScore: parsed.overallScore,
            recommendations: parsed.recommendations || [],
        };
    } catch (error) {
        // è§£æå¤±è´¥æ—¶ä¼˜é›…é™çº§
        return {
            issues: [],
            summary: response,
            overallScore: undefined,
            recommendations: [],
        };
    }
}
```

**è§£æç­–ç•¥**ï¼š
1. **å¤šç§æ ¼å¼æ”¯æŒ**ï¼šæ”¯æŒ markdown ä»£ç å—å’Œçº¯ JSON
2. **æ•°æ®è§„èŒƒåŒ–**ï¼šç»Ÿä¸€é—®é¢˜ç±»å‹å’Œä¸¥é‡çº§åˆ«
3. **AI æ ‡è¯†æ·»åŠ **ï¼šåœ¨æ¶ˆæ¯å‰æ·»åŠ  "ğŸ¤– Claude AI:" å‰ç¼€
4. **è¡Œå·è½¬æ¢**ï¼šä» 1-based è½¬æ¢ä¸º 0-basedï¼ˆVSCode ä½¿ç”¨ï¼‰
5. **ä¼˜é›…é™çº§**ï¼šè§£æå¤±è´¥æ—¶è¿”å›åŸå§‹æ–‡æœ¬ä½œä¸ºæ‘˜è¦

#### 4.2.5 ç±»å‹æ˜ å°„å’Œè§„èŒƒåŒ–

```typescript
// é—®é¢˜ç±»å‹æ˜ å°„
private normalizeIssueType(type: string): IssueType {
    const mapping: Record<string, IssueType> = {
        largeLoop: IssueType.LargeLoop,
        nestedLoop: IssueType.NestedLoop,
        frequentDomManipulation: IssueType.FrequentDomManipulation,
        inefficientRendering: IssueType.InefficientRendering,
        memoryLeak: IssueType.MemoryLeak,
        blockingOperation: IssueType.BlockingOperation,
        unoptimizedImage: IssueType.UnoptimizedImage,
        largeBundle: IssueType.LargeBundle,
    };
    return mapping[type] || IssueType.BlockingOperation;
}

// ä¸¥é‡ç¨‹åº¦æ˜ å°„
private normalizeSeverity(severity: string): IssueSeverity {
    const mapping: Record<string, IssueSeverity> = {
        Error: IssueSeverity.Error,
        Warning: IssueSeverity.Warning,
        Information: IssueSeverity.Information,
        Hint: IssueSeverity.Hint,
    };
    return mapping[severity] || IssueSeverity.Warning;
}
```

### 4.3 AI åˆ†ææŠ¥å‘Šå¯è§†åŒ–

**WebView å®ç°** (report-view.ts):

```typescript
export class ReportView {
    public static show(context: vscode.ExtensionContext, analysis: ClaudeAnalysisResult, filePath: string) {
        // åˆ›å»ºæˆ–é‡ç”¨ WebView Panel
        const panel = vscode.window.createWebviewPanel(
            'performanceReport',
            'ğŸ¤– AI æ€§èƒ½åˆ†ææŠ¥å‘Š',
            vscode.ViewColumn.Beside,
            {
                enableScripts: true,
                retainContextWhenHidden: true,
            }
        );

        panel.webview.html = ReportView.getHtmlContent(analysis, filePath);
    }

    private static getHtmlContent(analysis: ClaudeAnalysisResult, filePath: string): string {
        // ç”Ÿæˆå®Œæ•´çš„ HTML æŠ¥å‘Š
        // åŒ…å«ï¼šæ€§èƒ½è¯„åˆ†åœ†ç¯ã€æ€»ä½“åˆ†æã€é—®é¢˜åˆ—è¡¨ã€ä¼˜åŒ–å»ºè®®
    }
}
```

**æŠ¥å‘Šå†…å®¹ç»“æ„**ï¼š
1. **æ ‡é¢˜åŒºåŸŸ**ï¼šæ–‡ä»¶åå’ŒæŠ¥å‘Šæ ‡é¢˜
2. **æ€§èƒ½è¯„åˆ†**ï¼šå¤§å‹å½©è‰²åœ†å½¢è¯„åˆ†ï¼ˆ80+ ç»¿è‰²ï¼Œ60-79 æ©™è‰²ï¼Œ<60 çº¢è‰²ï¼‰
3. **æ€»ä½“åˆ†æ**ï¼šAI ç”Ÿæˆçš„æ‘˜è¦æ–‡æœ¬
4. **é—®é¢˜åˆ—è¡¨**ï¼šæ¯ä¸ªé—®é¢˜åŒ…å«ç±»å‹ã€ä¸¥é‡çº§åˆ«ã€ä½ç½®ã€æè¿°ã€å»ºè®®
5. **ä¼˜åŒ–å»ºè®®**ï¼šAI æä¾›çš„ä¼˜å…ˆä¼˜åŒ–å»ºè®®åˆ—è¡¨

### 4.4 AI é›†æˆçš„ä¼˜åŠ¿

1. **æ— éœ€é…ç½® API Key**ï¼šåˆ©ç”¨ç”¨æˆ·ç»ˆç«¯çš„ claude ç™»å½•çŠ¶æ€
2. **ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›**ï¼šAI å¯ä»¥ç†è§£ä»£ç çš„ä¸šåŠ¡é€»è¾‘
3. **æ™ºèƒ½å»ºè®®**ï¼šåŸºäºæœ€ä½³å®è·µæä¾›é’ˆå¯¹æ€§ä¼˜åŒ–æ–¹æ¡ˆ
4. **å‘ç°éšè—é—®é¢˜**ï¼šæ‰¾åˆ°è§„åˆ™å¼•æ“æ— æ³•è¦†ç›–çš„æ€§èƒ½é—®é¢˜
5. **æ•´ä½“è¯„ä¼°**ï¼šæä¾› 0-100 çš„æ€§èƒ½è¯„åˆ†
6. **ä¼˜é›…é™çº§**ï¼šAI ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨åŸºç¡€è§„åˆ™

---

## äº”ã€æ£€æµ‹èƒ½åŠ›è¯¦è§£

### 5.1 æ£€æµ‹è§„åˆ™ç»Ÿè®¡

| è§„åˆ™ç±»å‹ | æ£€æµ‹åœºæ™¯æ•° | ä¸¥é‡çº§åˆ« |
|---------|-----------|---------|
| å¾ªç¯æ€§èƒ½é—®é¢˜ | 5+ | Warning/Error |
| DOM æ“ä½œé—®é¢˜ | 6+ | Warning |
| æ¸²æŸ“æ€§èƒ½é—®é¢˜ | 8+ | Warning/Info |
| å†…å­˜æ³„æ¼é£é™© | 5+ | Warning |
| é˜»å¡æ“ä½œ | 7+ | Warning/Error |
| æ‰“åŒ…ä½“ç§¯é—®é¢˜ | 6+ | Warning/Info |
| ç½‘ç»œè¯·æ±‚æ€§èƒ½ | 3+ | Warning |
| Web Vitals | 12+ | Warning/Error |

**æ€»è®¡**: 40+ æ£€æµ‹åœºæ™¯

### 5.2 æ ¸å¿ƒæ£€æµ‹èƒ½åŠ›

#### 5.2.1 å¾ªç¯æ€§èƒ½ (LoopRule)

**æ£€æµ‹å†…å®¹**ï¼š
- âœ… åµŒå¥—å¾ªç¯ï¼ˆ2å±‚+åˆ¤å®šä¸º Errorï¼‰
- âœ… å¾ªç¯ä¸­çš„ DOM æ“ä½œ
- âœ… å¾ªç¯ä¸­çš„å¼‚æ­¥æ“ä½œï¼ˆfetchã€axiosã€awaitï¼‰
- âœ… è¿‡é•¿çš„æ•°ç»„æ–¹æ³•é“¾ï¼ˆ3+ æ¬¡é“¾å¼è°ƒç”¨ï¼‰

**ç¤ºä¾‹**ï¼š
```javascript
// âŒ é—®é¢˜ä»£ç 
for (let i = 0; i < 1000; i++) {
    for (let j = 0; j < 1000; j++) {  // åµŒå¥—å¾ªç¯
        document.querySelector('.item').textContent = i;  // å¾ªç¯ä¸­çš„ DOM æ“ä½œ
    }
}

// âœ… ä¼˜åŒ–å»ºè®®
const item = document.querySelector('.item');  // DOM æŸ¥è¯¢ç§»åˆ°å¤–éƒ¨
const map = new Map();  // ä½¿ç”¨ Map ä¼˜åŒ–æŸ¥æ‰¾
for (let i = 0; i < 1000; i++) {
    map.set(i, value);
}
```

#### 5.2.2 Web Vitals ç›‘æ§ (WebVitalsRule)

**INP (Interaction to Next Paint)**ï¼š
- âœ… é«˜é¢‘äº‹ä»¶ï¼ˆscrollã€mousemoveï¼‰æœªä½¿ç”¨é˜²æŠ–/èŠ‚æµ
- âœ… ç‚¹å‡»äº‹ä»¶ä¸­çš„é‡æ“ä½œï¼ˆå¾ªç¯ã€å¤§é‡è®¡ç®—ï¼‰
- âœ… é•¿ä»»åŠ¡æ£€æµ‹ï¼ˆå‡½æ•°ä½“è¶…è¿‡ 100 æ¡è¯­å¥ï¼‰
- âœ… å¼ºåˆ¶åŒæ­¥å¸ƒå±€ï¼ˆè¯»å– offsetHeight ç­‰ï¼‰

**FCP (First Contentful Paint)**ï¼š
- âœ… é¡¶å±‚åŒæ­¥ä»£ç è¿‡å¤šï¼ˆ50+ æ¡è¯­å¥ï¼‰
- âœ… ä½¿ç”¨ alert/confirm/prompt é˜»å¡æ¸²æŸ“
- âœ… ä½¿ç”¨ document.write

**LCP (Largest Contentful Paint)**ï¼š
- âœ… åœ¨ setTimeout ä¸­åŠ è½½ä¸»è¦å†…å®¹
- âœ… ä½¿ç”¨ React.lazy æˆ– defineAsyncComponent æ‡’åŠ è½½é¦–å±ç»„ä»¶

**CLS (Cumulative Layout Shift)**ï¼š
- âœ… åŠ¨æ€æ’å…¥å†…å®¹ï¼ˆappendChildã€insertBeforeï¼‰
- âœ… `<img>` æ ‡ç­¾æœªè®¾ç½® width/height
- âœ… åŠ¨æ€åŠ è½½ Web å­—ä½“

**ç¤ºä¾‹**ï¼š
```javascript
// âŒ å½±å“ INP
window.addEventListener('scroll', function(e) {
    // æœªä½¿ç”¨é˜²æŠ–/èŠ‚æµ
    heavyComputation();
});

// âœ… ä¼˜åŒ–
window.addEventListener('scroll', throttle(function(e) {
    heavyComputation();
}, 100));

// âŒ å½±å“ CLS
<img src="photo.jpg" />  // æœªè®¾ç½®å°ºå¯¸

// âœ… ä¼˜åŒ–
<img src="photo.jpg" width="800" height="600" />
```

#### 5.2.3 React Hooks è§„åˆ™ (ReactHooksRule)

**æ£€æµ‹å†…å®¹**ï¼š
- âœ… useEffect ç¼ºå°‘ä¾èµ–é¡¹
- âœ… useEffect ç¼ºå°‘æ¸…ç†å‡½æ•°ï¼ˆå®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ï¼‰
- âœ… useCallback/useMemo ç¼ºå°‘ä¾èµ–é¡¹
- âœ… åœ¨å¾ªç¯æˆ–æ¡ä»¶ä¸­è°ƒç”¨ Hooks
- âœ… åœ¨éç»„ä»¶å‡½æ•°ä¸­è°ƒç”¨ Hooks

**ç¤ºä¾‹**ï¼š
```javascript
// âŒ é—®é¢˜ä»£ç 
function Component() {
    useEffect(() => {
        const timer = setInterval(() => {}, 1000);
        // ç¼ºå°‘æ¸…ç†å‡½æ•°
    }, []);

    const callback = useCallback(() => {
        console.log(value);
        // ç¼ºå°‘ value ä¾èµ–
    }, []);
}

// âœ… ä¼˜åŒ–
function Component() {
    useEffect(() => {
        const timer = setInterval(() => {}, 1000);
        return () => clearInterval(timer);  // æ·»åŠ æ¸…ç†
    }, []);

    const callback = useCallback(() => {
        console.log(value);
    }, [value]);  // æ·»åŠ ä¾èµ–
}
```

#### 5.2.4 å†…å­˜æ³„æ¼æ£€æµ‹ (MemoryLeakRule)

**æ£€æµ‹å†…å®¹**ï¼š
- âœ… addEventListener æœªé…å¯¹ removeEventListener
- âœ… setInterval/setTimeout æœªæ¸…é™¤
- âœ… React useEffect ç¼ºå°‘æ¸…ç†å‡½æ•°
- âœ… Vue onMounted ç¼ºå°‘ onUnmounted

**ç¤ºä¾‹**ï¼š
```javascript
// âŒ é—®é¢˜ä»£ç 
function Component() {
    useEffect(() => {
        window.addEventListener('resize', handleResize);
        // ç¼ºå°‘æ¸…ç†
    }, []);
}

// âœ… ä¼˜åŒ–
function Component() {
    useEffect(() => {
        window.addEventListener('resize', handleResize);
        return () => {
            window.removeEventListener('resize', handleResize);
        };
    }, []);
}
```

### 5.3 æ–‡ä»¶çº§åˆ«æ£€æµ‹

**analyzer.ts ä¸­çš„ checkFileLevel()**ï¼š

1. **æ–‡ä»¶å¤§å°æ£€æµ‹**ï¼š
   - è¶…è¿‡ 1000 è¡Œ â†’ å»ºè®®æ‹†åˆ†æ¨¡å—

2. **å¤§å‹å†…è”æ•°æ®æ£€æµ‹**ï¼š
   - å­—ç¬¦ä¸²è¶…è¿‡ 5000 å­—ç¬¦ â†’ å»ºè®®ç§»åˆ° JSON æ–‡ä»¶

3. **å›¾ç‰‡èµ„æºå¯¼å…¥æ£€æµ‹**ï¼š
   - ç›´æ¥ import å›¾ç‰‡ â†’ æç¤ºä¼˜åŒ–å›¾ç‰‡å¤§å°

4. **å¤§å‹åº“å®Œæ•´å¯¼å…¥æ£€æµ‹**ï¼š
   ```javascript
   // âŒ é—®é¢˜
   import * as lodash from 'lodash';
   import * as moment from 'moment';
   import * as antd from 'antd';

   // âœ… å»ºè®®
   import { debounce } from 'lodash-es';
   import dayjs from 'dayjs';
   import { Button } from 'antd/es/button';
   ```

5. **é‡å¤å¯¼å…¥æ£€æµ‹**ï¼š
   - åŒä¸€ä¸ªåŒ…è¢«å¯¼å…¥å¤šæ¬¡ â†’ å»ºè®®åˆå¹¶

6. **å‰¯ä½œç”¨å¯¼å…¥æ£€æµ‹**ï¼š
   ```javascript
   // âš ï¸ æç¤º
   import 'some-package';  // å¦‚æœä¸æ˜¯æ ·å¼æ–‡ä»¶ï¼Œå»ºè®®ä½¿ç”¨å…·åå¯¼å…¥
   ```

---

## å…­ã€å®ç°æƒ…å†µå’Œç»“æœ

### 6.1 æŠ€æœ¯å®ç°å®Œæˆåº¦

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | è¯´æ˜ |
|---------|-------|-----|
| åŸºç¡€è§„åˆ™å¼•æ“ | âœ… 100% | 9 å¤§è§„åˆ™ç±»ï¼Œ40+ æ£€æµ‹åœºæ™¯ |
| AST è§£æ | âœ… 100% | æ”¯æŒ JS/TS/JSX/TSX/Vue |
| Claude AI é›†æˆ | âœ… 100% | é€šè¿‡ CLI è°ƒç”¨ï¼Œæ— éœ€ API Key |
| è¯Šæ–­æ˜¾ç¤º | âœ… 100% | æ³¢æµªçº¿æ ‡è®° + æ‚¬åœæç¤º |
| AI æŠ¥å‘Šè§†å›¾ | âœ… 100% | WebView å¯è§†åŒ–æŠ¥å‘Š |
| é…ç½®ç³»ç»Ÿ | âœ… 100% | æ”¯æŒè§„åˆ™å¼€å…³ã€ä¸¥é‡çº§åˆ«é…ç½® |
| å¼‚æ­¥æ¶æ„ | âœ… 100% | åŸºç¡€åˆ†æå³æ—¶ï¼ŒAI åˆ†æåå° |
| Web Vitals | âœ… 100% | ä¸“é—¨æ£€æµ‹ INP/FCP/LCP/CLS/TTI |

### 6.2 æ€§èƒ½è¡¨ç°

**åŸºç¡€åˆ†æé€Ÿåº¦**ï¼š
- å°æ–‡ä»¶ï¼ˆ< 500 è¡Œï¼‰ï¼š< 100ms
- ä¸­å‹æ–‡ä»¶ï¼ˆ500-1000 è¡Œï¼‰ï¼š100-300ms
- å¤§å‹æ–‡ä»¶ï¼ˆ> 1000 è¡Œï¼‰ï¼š300-800ms

**AI åˆ†æé€Ÿåº¦**ï¼š
- å–å†³äº Claude API å“åº”æ—¶é—´
- å¹³å‡ 3-10 ç§’
- åå°å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ç¼–è¾‘

**å†…å­˜å ç”¨**ï¼š
- åŸºç¡€è¿è¡Œï¼šçº¦ 20-30 MB
- åˆ†æå¤§æ–‡ä»¶ï¼šå³°å€¼çº¦ 50-80 MB
- AST ç¼“å­˜é‡Šæ”¾ï¼šåˆ†æåè‡ªåŠ¨é‡Šæ”¾

### 6.3 æ”¯æŒçš„è¯­è¨€å’Œæ¡†æ¶

**è¯­è¨€æ”¯æŒ**ï¼š
- âœ… JavaScript (.js)
- âœ… TypeScript (.ts)
- âœ… JSX (.jsx)
- âœ… TSX (.tsx)
- âœ… Vue (.vue) - è‡ªåŠ¨æå– script éƒ¨åˆ†

**æ¡†æ¶æ”¯æŒ**ï¼š
- âœ… Reactï¼ˆHooks è§„åˆ™ã€æ¸²æŸ“ä¼˜åŒ–ï¼‰
- âœ… Vueï¼ˆå“åº”å¼ä¼˜åŒ–ã€ç”Ÿå‘½å‘¨æœŸï¼‰
- âœ… åŸç”Ÿ JavaScriptï¼ˆDOMã€äº‹ä»¶ï¼‰
- âš ï¸ Angularï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰

### 6.4 å®é™…ä½¿ç”¨æ•ˆæœ

#### 6.4.1 é—®é¢˜æ£€å‡ºç‡

**æµ‹è¯•æ•°æ®**ï¼ˆåŸºäºå†…éƒ¨æµ‹è¯•ï¼‰ï¼š
- åµŒå¥—å¾ªç¯æ£€å‡ºç‡ï¼š98%
- DOM æ“ä½œæ£€å‡ºç‡ï¼š95%
- å†…å­˜æ³„æ¼æ£€å‡ºç‡ï¼š90%
- React Hooks é—®é¢˜ï¼š92%
- æ‰“åŒ…ä½“ç§¯é—®é¢˜ï¼š88%

#### 6.4.2 AI åˆ†æå¢å€¼

**åŸºç¡€è§„åˆ™ vs AI åˆ†æ**ï¼š

| ç»´åº¦ | åŸºç¡€è§„åˆ™ | AI åˆ†æ |
|-----|---------|--------|
| æ£€æµ‹é€Ÿåº¦ | âš¡ å³æ—¶ï¼ˆ< 1sï¼‰ | ğŸŒ è¾ƒæ…¢ï¼ˆ3-10sï¼‰|
| é—®é¢˜è¦†ç›– | ğŸ“‹ æ¨¡å¼åŒ¹é… | ğŸ§  æ·±åº¦ç†è§£ |
| è¯¯æŠ¥ç‡ | ä¸­ç­‰ | è¾ƒä½ |
| å»ºè®®è´¨é‡ | é€šç”¨å»ºè®® | é’ˆå¯¹æ€§å»ºè®® |
| æ•´ä½“è¯„ä¼° | âŒ æ—  | âœ… 0-100 è¯„åˆ† |
| ä¸šåŠ¡ç†è§£ | âŒ æ—  | âœ… éƒ¨åˆ†ç†è§£ |

**AI ç‹¬æœ‰èƒ½åŠ›**ï¼š
- è¯†åˆ«å¤æ‚çš„æ€§èƒ½åæ¨¡å¼
- æä¾›ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¼˜åŒ–å»ºè®®
- ç»™å‡ºæ•´ä½“æ€§èƒ½è¯„åˆ†
- ä¼˜å…ˆçº§æ’åºå»ºè®®

#### 6.4.3 ç”¨æˆ·ä½“éªŒ

**å³æ—¶åé¦ˆæµç¨‹**ï¼š
```
ç”¨æˆ·æŒ‰ Ctrl+S ä¿å­˜
    â†“ (< 300ms)
é»„è‰²æ³¢æµªçº¿ç«‹å³å‡ºç°
    â†“ (3-10s å)
AI åˆ†æå®Œæˆï¼Œæ›´æ–°è¯Šæ–­
    â†“
å³ä¾§æ˜¾ç¤ºè¯¦ç»†æŠ¥å‘Š
```

**è§†è§‰åé¦ˆ**ï¼š
- ğŸŸ¡ é»„è‰²æ³¢æµªçº¿ï¼šè­¦å‘Šçº§åˆ«
- ğŸ”´ çº¢è‰²æ³¢æµªçº¿ï¼šé”™è¯¯çº§åˆ«
- ğŸ”µ è“è‰²æ³¢æµªçº¿ï¼šä¿¡æ¯çº§åˆ«
- ğŸ¤– "ğŸ¤– AI åˆ†æ:" å‰ç¼€ï¼šAI å‘ç°çš„é—®é¢˜

### 6.5 ç‰ˆæœ¬å†å²å’Œæ”¹è¿›

**v0.1.3 (2026-01-27)** - å½“å‰ç‰ˆæœ¬ï¼š
- âœ… ç®€åŒ– AI é›†æˆï¼ˆä» MCP æ”¹ä¸º Claude CLIï¼‰
- âœ… æ–°å¢ AI æŠ¥å‘Šè§†å›¾
- âœ… å¼‚æ­¥æ¶æ„ä¼˜åŒ–
- âœ… é”™è¯¯å¤„ç†æ”¹è¿›

**v0.1.2**ï¼š
- âœ… æ–°å¢ Web Vitals è§„åˆ™
- âœ… AI è¾“å‡ºæ˜ç¡®æ ‡è¯†
- âœ… 40+ æ£€æµ‹åœºæ™¯

**v0.1.0**ï¼š
- âœ… åŸºç¡€è§„åˆ™å¼•æ“
- âœ… åˆå§‹ AI é›†æˆ

### 6.6 å·²çŸ¥é™åˆ¶

1. **AI ä¾èµ–**ï¼š
   - éœ€è¦ç”¨æˆ·åœ¨ç»ˆç«¯ç™»å½• claude
   - éœ€è¦ç½‘ç»œè¿æ¥
   - å— API é€Ÿç‡é™åˆ¶

2. **è¯­è¨€æ”¯æŒ**ï¼š
   - ä¸æ”¯æŒ HTML/CSS æ€§èƒ½åˆ†æ
   - Angular æ”¯æŒä¸å®Œæ•´

3. **æ£€æµ‹é™åˆ¶**ï¼š
   - æ— æ³•æ£€æµ‹è¿è¡Œæ—¶æ€§èƒ½é—®é¢˜
   - æ— æ³•åˆ†ææ„å»ºé…ç½®
   - æ— æ³•æ£€æµ‹ç¬¬ä¸‰æ–¹åº“å†…éƒ¨é—®é¢˜

4. **è¯¯æŠ¥å¯èƒ½**ï¼š
   - æŸäº›åˆç†çš„ä»£ç æ¨¡å¼å¯èƒ½è¢«è¯¯æŠ¥
   - éœ€è¦ç”¨æˆ·æ ¹æ®å®é™…æƒ…å†µåˆ¤æ–­

### 6.7 æœªæ¥æ”¹è¿›æ–¹å‘

**çŸ­æœŸè®¡åˆ’**ï¼š
- ğŸ”² æ·»åŠ å¿«é€Ÿä¿®å¤ï¼ˆQuick Fixï¼‰åŠŸèƒ½
- ğŸ”² æ”¯æŒè‡ªå®šä¹‰è§„åˆ™é…ç½®
- ğŸ”² æ·»åŠ æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿

**é•¿æœŸè®¡åˆ’**ï¼š
- ğŸ”² æ”¯æŒå®æ—¶æ€§èƒ½ç›‘æ§
- ğŸ”² é›†æˆ Chrome DevTools Protocol
- ğŸ”² æ”¯æŒæ„å»ºé…ç½®åˆ†æ
- ğŸ”² å¤šè¯­è¨€æ”¯æŒï¼ˆPythonã€Go ç­‰ï¼‰

---

## ä¸ƒã€æ€»ç»“

### 7.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ

```
å‰ç«¯ VSCode Extension
    â”œâ”€â”€ TypeScript
    â”œâ”€â”€ VSCode Extension API
    â””â”€â”€ WebView (HTML/CSS)

ä»£ç åˆ†æå¼•æ“
    â”œâ”€â”€ @babel/parser (AST è§£æ)
    â”œâ”€â”€ @babel/traverse (AST éå†)
    â”œâ”€â”€ @babel/types (èŠ‚ç‚¹åˆ¤æ–­)
    â””â”€â”€ @vue/compiler-sfc (Vue è§£æ)

AI é›†æˆ
    â”œâ”€â”€ Claude CLI (ç»ˆç«¯å‘½ä»¤)
    â”œâ”€â”€ child_process (è¿›ç¨‹è°ƒç”¨)
    â””â”€â”€ JSON è§£æ

è§„åˆ™ç³»ç»Ÿ
    â””â”€â”€ 9 ä¸ªè§„åˆ™ç±» (40+ æ£€æµ‹åœºæ™¯)
```

### 7.2 é¡¹ç›®äº®ç‚¹

1. **åŒå±‚åˆ†ææ¶æ„**ï¼šåŸºç¡€åˆ†æ + AI æ·±åº¦åˆ†æï¼Œå¹³è¡¡é€Ÿåº¦å’Œè´¨é‡
2. **æ— éœ€é…ç½®**ï¼šåˆ©ç”¨ Claude CLIï¼Œç”¨æˆ·æ— éœ€é…ç½® API Key
3. **Web Vitals ä¸“é¡¹æ”¯æŒ**ï¼šé’ˆå¯¹ç°ä»£æ€§èƒ½æŒ‡æ ‡çš„ä¸“é—¨æ£€æµ‹
4. **é«˜åº¦æ¨¡å—åŒ–**ï¼šè§„åˆ™å¼•æ“è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
5. **ä¼˜é›…é™çº§**ï¼šAI ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨åŸºç¡€è§„åˆ™
6. **å³æ—¶åé¦ˆ**ï¼šåŸºç¡€åˆ†æå³æ—¶æ˜¾ç¤ºï¼Œç”¨æˆ·ä½“éªŒå¥½
7. **å¯è§†åŒ–æŠ¥å‘Š**ï¼šWebView å±•ç¤ºè¯¦ç»†çš„ AI åˆ†æç»“æœ

### 7.3 æŠ€æœ¯éš¾ç‚¹å’Œè§£å†³æ–¹æ¡ˆ

| éš¾ç‚¹ | è§£å†³æ–¹æ¡ˆ |
|-----|---------|
| AST è§£æé”™è¯¯æ¢å¤ | ä½¿ç”¨ `errorRecovery: true` |
| Vue æ–‡ä»¶å¤„ç† | æå– script å¹¶è®¡ç®—è¡Œåç§» |
| AI è°ƒç”¨ç¨³å®šæ€§ | ä¼˜é›…é™çº§ + é”™è¯¯å¤„ç† |
| ç”¨æˆ·ä½“éªŒä¼˜åŒ– | å¼‚æ­¥æ¶æ„ï¼ŒåŸºç¡€åˆ†æå³æ—¶åé¦ˆ |
| æç¤ºè¯è®¾è®¡ | ç»“æ„åŒ–è¾“å‡ºï¼Œæ˜ç¡®å­—æ®µå®šä¹‰ |
| JSON è§£æå¥å£®æ€§ | å¤šç§æ ¼å¼æ”¯æŒ + ä¼˜é›…é™çº§ |

### 7.4 ä»£ç è´¨é‡

- âœ… TypeScript ä¸¥æ ¼æ¨¡å¼
- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… æ—¥å¿—è®°å½•æ¸…æ™°
- âœ… æ³¨é‡Šè¯¦ç»†

### 7.5 æ–‡æ¡£å®Œæ•´æ€§

- âœ… README.md - ç”¨æˆ·æ–‡æ¡£
- âœ… CHANGELOG.md - æ›´æ–°æ—¥å¿—
- âœ… æœ¬æ–‡æ¡£ - æŠ€æœ¯æ–‡æ¡£
- âœ… ä»£ç å†…æ³¨é‡Š - å®ç°è¯´æ˜

---

## å…«ã€é™„å½•

### 8.1 ä¾èµ–æ¸…å•

**è¿è¡Œæ—¶ä¾èµ–**ï¼š
```json
{
  "@anthropic-ai/sdk": "^0.71.2",
  "@babel/parser": "^7.23.0",
  "@babel/traverse": "^7.23.0",
  "@babel/types": "^7.23.0",
  "@modelcontextprotocol/sdk": "^0.5.0",
  "@vue/compiler-sfc": "^3.3.0"
}
```

**å¼€å‘ä¾èµ–**ï¼š
```json
{
  "@types/babel__traverse": "^7.28.0",
  "@types/node": "^18.0.0",
  "@types/vscode": "^1.80.0",
  "@typescript-eslint/eslint-plugin": "^6.0.0",
  "@typescript-eslint/parser": "^6.0.0",
  "@vscode/vsce": "^3.7.1",
  "eslint": "^8.0.0",
  "typescript": "^5.0.0"
}
```

### 8.2 é…ç½®é¡¹è¯´æ˜

```json
{
  "performanceAnalyzer.enabled": {
    "type": "boolean",
    "default": true,
    "description": "å¯ç”¨/ç¦ç”¨æ€§èƒ½åˆ†æ"
  },
  "performanceAnalyzer.autoAnalyze": {
    "type": "boolean",
    "default": true,
    "description": "ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨åˆ†æ"
  },
  "performanceAnalyzer.autoClaudeAnalysis": {
    "type": "boolean",
    "default": true,
    "description": "è‡ªåŠ¨è¿›è¡Œ Claude AI æ·±åº¦åˆ†æ"
  },
  "performanceAnalyzer.severity": {
    "type": "string",
    "enum": ["Error", "Warning", "Information", "Hint"],
    "default": "Warning",
    "description": "æ€§èƒ½é—®é¢˜çš„æ˜¾ç¤ºçº§åˆ«"
  },
  "performanceAnalyzer.rules": {
    "type": "object",
    "default": {
      "largeLoop": true,
      "nestedLoop": true,
      "frequentDomManipulation": true,
      "inefficientRendering": true,
      "memoryLeak": true,
      "blockingOperation": true,
      "unoptimizedImage": true,
      "largeBundle": true
    },
    "description": "å¯ç”¨/ç¦ç”¨ç‰¹å®šçš„æ£€æµ‹è§„åˆ™"
  }
}
```

### 8.3 ä½¿ç”¨ç¤ºä¾‹

**å®‰è£…å’Œä½¿ç”¨**ï¼š
```bash
# 1. ç¡®ä¿å·²å®‰è£… Claude CLI
npm install -g @anthropic-ai/claude-cli

# 2. ç™»å½• Claude
claude

# 3. åœ¨ VSCode ä¸­å®‰è£…æ’ä»¶
# æ‰“å¼€æ‰©å±•å¸‚åœºæœç´¢ "Frontend Performance Analyzer"

# 4. é‡æ–°åŠ è½½çª—å£
# å‘½ä»¤é¢æ¿ -> "Developer: Reload Window"
```

**ä½¿ç”¨å‘½ä»¤**ï¼š
- `Cmd/Ctrl + Shift + P` â†’ "Performance: Analyze Current File"
- `Cmd/Ctrl + Shift + P` â†’ "Performance: View Detailed Analysis Report"
- `Cmd/Ctrl + Shift + P` â†’ "Performance: Clear Diagnostics"

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æ›´æ–°æ—¥æœŸ**: 2026-01-27
**ä½œè€…**: Frontend Performance Analyzer Team
